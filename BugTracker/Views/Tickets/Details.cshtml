
@using BugTracker.Helpers
@using Microsoft.AspNet.Identity
@using BugTracker.Models
@using System.IO



@model BugTracker.Models.Ticket


@{
    var userId = User.Identity.GetUserId();
    ApplicationUser user = new ApplicationUser();
    var linkHelper = new LinkHelper();
    var projectHelper = new ProjectsHelper();
    var currentProjectManagers = projectHelper.UsersInRoleOnProject2(Model.ProjectId, "Project Manager");
    



    if (userId != null)
    {
        var db = new ApplicationDbContext();
        user = db.Users.Find(userId);

        


    }



}

    <style>
        .notification-messages {
            color: #000000;
        }

            .notification-messages .date {
                opacity: 0.8;
            }


        time.timeline-time {
    width: 10px;
}
    </style>

    <div class="modal fade" id="EditTicket" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <br>
                    <i class="fa fa-credit-card fa-7x"></i>
                    <h4 id="CreateTicket" class="semi-bold">Hello @user.FirstName </h4>
                    <p class="no-margin">PLEASE FILL OUT ALL AVAILABLE INFORMATION FOR TICKET </p>
                    <br>
                </div>
                @using (Html.BeginForm("Edit", "Tickets", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()

                    
                    @Html.Hidden("Id", Model.Id)
                    @Html.Hidden("TicketStatusId", Model.TicketStatusId)
                    
                    
                    <div class="modal-body">



                        <div class="row form-row">
                            <div class="col-md-8">
                                @Html.EditorFor(model => model.Title, new { htmlAttributes = new { @class = "form-control col-md-8" } })
                            </div>
                            <div class="col-md-4">
                                @Html.DropDownList("ProjectID", null, "Project", htmlAttributes: new { @class = "form-control" })
                            </div>
                        </div>
                        <div class="row form-row">
                            <div class="col-md-12">
                                @Html.EditorFor(model => model.Description, new { htmlAttributes = new { @class = "form-control col-md-12" } })
                            </div>
                        </div>
                        <div class="row form-row">
                            <div class="col-md-4">
                                @Html.DropDownList("TicketTypeId", null, "Type", htmlAttributes: new { @class = "form-control" })
                            </div>
                            <div class="col-md-4">
                                @Html.DropDownList("TicketPriorityId", null, "Priority", htmlAttributes: new { @class = "form-control" })
                            </div>
                            @if (linkHelper.UserCanAssignTicket(Model))
                            {
                                <div class="col-md-4">
                                    @Html.DropDownList("AssignedToUserId", null, "Developers", htmlAttributes: new { @class = "form-control" })
                                </div>
                            }

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>





                }


            </div>
        </div>
    </div>
    <div class="modal fade" id="Archive" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <br>
                    <i class="fa fa-credit-card fa-7x"></i>
                    <h4 id="CreateTicket" class="semi-bold">Hello @user.FirstName </h4>
                    <p class="no-margin">ARE YOU SURE YOU WANT TO ARCHIVE TICKET? </p>
                    <br>
                </div>
                @using (Html.BeginForm("ArchiveP", "Tickets", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()

                    @Html.Hidden("ticketId", Model.Id)
                    @Html.Hidden("userId", userId)

                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">NO</button>
                        <button type="submit" class="btn btn-primary">YES</button>
                    </div>





                }


            </div>
        </div>
    </div>


<div class="page-title">
    <h3>@Model.Title Dashboard </h3>
</div>
<div id="container">
    @if (User.IsInRole("Admin") || User.IsInRole("MasterAdmin"))
    {
        <div class="row 2col container-fluid">
            <div class="col-md-3 col-sm-6 spacing-bottom-sm spacing-bottom">
                <div class="tiles blue added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Progress </div>
                        <div class="heading"> <span class="animate-number" data-value="@Model.TicketStatus.Value" data-animation-duration="1200">0</span>% </div>
                        <div class="progress transparent progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@Model.TicketStatus.Value%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @Model.TicketStatus.Name</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 spacing-bottom-sm spacing-bottom">
                <div class="tiles green added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Priority </div>
                        <div class="heading"> @Model.TicketPriority.Name </div>
                        <div class="progress transparent progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@TicketHelper.GetTicketPercentageByPriorityA(Model.Id)%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @TicketHelper.GetTicketPercentageByPriorityA(Model.Id)% of System Tickets </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 spacing-bottom">
                <div class="tiles red added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Type </div>
                        <div class="heading"> @Model.TicketType.Name </div>
                        <div class="progress transparent progress-white progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@TicketHelper.GetTicketPercentageByTypeA(Model.Id)%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @TicketHelper.GetTicketPercentageByTypeA(Model.Id)% of System Tickets</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="tiles purple added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Manage Ticket</div>
                        <div class="row-fluid">
                            @if (Model.TicketStatus.Name == "New / Unassigned")
                            {
                                <div class="heading"><button data-toggle="modal" data-target="#EditTicket" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Assign Ticket</button></div>
                            }
                            else if (Model.TicketStatus.Name == "Assigned")
                            {
                                <div class="heading"><button data-toggle="modal" data-target="#EditTicket" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Re-assign</button></div>
                            }
                            else if (Model.TicketStatus.Name == "Assigned / In Progress")
                            {
                                <div class="heading"><button data-toggle="modal" data-target="#EditTicket" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Re-assign</button></div>
                            }
                            else if (Model.TicketStatus.Name == "Resolved")
                            {
                                <div class="heading"><button data-toggle="modal" data-target="#Archive" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Archive</button></div>
                                
                                <div class="heading"><button data-toggle="modal" data-target="#EditTicket" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Re-assign</button></div>
                            }
                            else
                            {
                                <div class="heading">This Ticket Has Been Resolve/Archived</div>
                            }


                        </div>
                        <div class="description">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    else if (User.IsInRole("Project Manager"))
    {
        <div class="row 2col container-fluid">
            <div class="col-md-3 col-sm-6 spacing-bottom-sm spacing-bottom">
                <div class="tiles blue added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Progress </div>
                        <div class="heading"> <span class="animate-number" data-value="@Model.TicketStatus.Value" data-animation-duration="1200">0</span>% </div>
                        <div class="progress transparent progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@Model.TicketStatus.Value%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @Model.TicketStatus.Name</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 spacing-bottom-sm spacing-bottom">
                <div class="tiles green added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Priority </div>
                        <div class="heading"> @Model.TicketPriority.Name </div>
                        <div class="progress transparent progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@TicketHelper.GetTicketPercentageByPriorityP(Model.Id)%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @TicketHelper.GetTicketPercentageByPriorityP(Model.Id)% of your tickets </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 spacing-bottom">
                <div class="tiles red added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Type </div>
                        <div class="heading"> @Model.TicketType.Name </div>
                        <div class="progress transparent progress-white progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@TicketHelper.GetTicketPercentageByTypeP(Model.Id)%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @TicketHelper.GetTicketPercentageByTypeP(Model.Id)% of your tickets</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 col-sm-6">
                <div class="tiles purple added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Manage Ticket</div>
                        <div class="row-fluid">
                            @if (Model.TicketStatus.Name == "New / Unassigned")
                            {
                                <div class="heading"><button data-toggle="modal" data-target="#EditTicket" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Assign Ticket</button></div>
                            }
                            else if (Model.TicketStatus.Name == "Assigned")
                            {
                                <div class="heading"><button data-toggle="modal" data-target="#EditTicket" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Re-assign</button></div>
                            }
                            else if (Model.TicketStatus.Name == "Assigned / In Progress")
                            {
                                <div class="heading"><button data-toggle="modal" data-target="#EditTicket" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Re-assign</button></div>
                            }
                            else if (Model.TicketStatus.Name == "Resolved")
                            {
                                <div class="heading"><button data-toggle="modal" data-target="#Archive" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Archive</button></div>
                                
                                <div class="heading"><button data-toggle="modal" data-target="#EditTicket" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Re-assign</button></div>
                            }
                            else
                            {
                                <div class="heading h4" >This Ticket Has Been Archived</div>
                            }


                        </div>
                        <div class="description">

                        </div>
                    </div>
                </div>
            </div>

        </div>

    }
    else if (User.IsInRole("Developer"))
    {
        <div class="row 2col container-fluid">
            <div class="col-md-3 col-sm-6 spacing-bottom-sm spacing-bottom">
                <div class="tiles blue added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Progress </div>
                        <div class="heading"> <span class="animate-number" data-value="@Model.TicketStatus.Value" data-animation-duration="1200">0</span>% </div>
                        <div class="progress transparent progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@Model.TicketStatus.Value%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @Model.TicketStatus.Name</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 spacing-bottom-sm spacing-bottom">
                <div class="tiles green added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Priority </div>
                        <div class="heading"> @Model.TicketPriority.Name </div>
                        <div class="progress transparent progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@TicketHelper.GetTicketPercentageByPriority(Model.Id)%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @TicketHelper.GetTicketPercentageByPriority(Model.Id)% of your tickets </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 spacing-bottom">
                <div class="tiles red added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Type </div>
                        <div class="heading"> @Model.TicketType.Name </div>
                        <div class="progress transparent progress-white progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@TicketHelper.GetTicketPercentageByType(Model.Id)%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @TicketHelper.GetTicketPercentageByType(Model.Id)% of your tickets</span>
                        </div>
                    </div>
                </div>
            </div>

            @using (Html.BeginForm("Advance", "Tickets", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                @Html.Hidden("ticketId", Model.Id)
                <div class="col-md-3 col-sm-6">
                    <div class="tiles purple added-margin">
                        <div class="tiles-body">
                            <div class="controller">
                                <a href="javascript:;" class="reload"></a>
                                <a href="javascript:;" class="remove"></a>
                            </div>
                            <div class="tiles-title"> Manage Ticket</div>
                            <div class="row-fluid">
                                @if (Model.TicketStatus.Name == "Assigned")
                                {
                                    <div class="heading"><button type="submit" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Start Ticket</button></div>
                                }
                                else if (Model.TicketStatus.Name == "Assigned / In Progress")
                                {
                                    <div class="heading"><button type="submit" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Complete Ticket</button></div>
                                }
                                else if (Model.TicketStatus.Name == "Resolved")
                                {
                                    <div class="heading">Pending Project Manger Review</div>
                                }
                                else
                                {
                                    <div class="heading">This Ticket Has Been Resolve/Archived</div>
                                }
                                
                                @*<div class="progress transparent progress-white progress-small no-radius">
                                        <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@Model.TicketStatus.Value%"></div>
                                    </div>*@
                            </div>
                            <div class="description">

                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else if (User.IsInRole("Submitter"))
    {
        <div class="row 2col container-fluid">
            <div class="col-md-3 col-sm-6 spacing-bottom-sm spacing-bottom">
                <div class="tiles blue added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Progress </div>
                        <div class="heading"> <span class="animate-number" data-value="@Model.TicketStatus.Value" data-animation-duration="1200">0</span>% </div>
                        <div class="progress transparent progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@Model.TicketStatus.Value%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @Model.TicketStatus.Name</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 spacing-bottom-sm spacing-bottom">
                <div class="tiles green added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Priority </div>
                        <div class="heading"> @Model.TicketPriority.Name </div>
                        <div class="progress transparent progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@TicketHelper.GetTicketPercentageByPriorityS(Model.Id)%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @TicketHelper.GetTicketPercentageByPriorityS(Model.Id)% of your tickets </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 spacing-bottom">
                <div class="tiles red added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Type </div>
                        <div class="heading"> @Model.TicketType.Name </div>
                        <div class="progress transparent progress-white progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@TicketHelper.GetTicketPercentageByTypeS(Model.Id)%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @TicketHelper.GetTicketPercentageByTypeS(Model.Id)% of your tickets</span>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-md-3 col-sm-6">
                <div class="tiles purple added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Manage Ticket</div>
                        <div class="row-fluid">
                            <div class="heading"><button data-toggle="modal" data-target="#EditTicket" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Edit Ticket</button></div>
                            @*<div class="progress transparent progress-white progress-small no-radius">
                                    <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@Model.TicketStatus.Value%"></div>
                                </div>*@
                        </div>
                        <div class="description">

                        </div>
                    </div>
                </div>
            </div>

        </div>
    }
    else
    {
        <div class="row 2col container-fluid">
            <div class="col-md-3 col-sm-6 spacing-bottom-sm spacing-bottom">
                <div class="tiles blue added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Progress </div>
                        <div class="heading"> <span class="animate-number" data-value="@Model.TicketStatus.Value" data-animation-duration="1200">0</span>% </div>
                        <div class="progress transparent progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@Model.TicketStatus.Value%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; @Model.TicketStatus.Name</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 spacing-bottom-sm spacing-bottom">
                <div class="tiles green added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Priority </div>
                        <div class="heading"> @Model.TicketPriority.Name </div>
                        <div class="progress transparent progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="79%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; ?% of your tickets </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6 spacing-bottom">
                <div class="tiles red added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Ticket Type </div>
                        <div class="heading"> @Model.TicketType.Name </div>
                        <div class="progress transparent progress-white progress-small no-radius">
                            <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="45%"></div>
                        </div>
                        <div class="description">
                            <i class="icon-custom-up"></i><span class="text-white mini-description ">&nbsp; 5% of your tickets</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="tiles purple added-margin">
                    <div class="tiles-body">
                        <div class="controller">
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <div class="tiles-title"> Manage Ticket</div>
                        <div class="row-fluid">
                            <div class="heading"><button type="button" class="btn btn-primary btn-cons"><i class="fa fa-check"></i>&nbsp;Advance Ticket</button></div>
                            @*<div class="progress transparent progress-white progress-small no-radius">
                                    <div class="progress-bar progress-bar-white animate-progress-bar" data-percentage="@Model.TicketStatus.Value%"></div>
                                </div>*@
                        </div>
                        <div class="description">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    }


    @*Project Chart and Ticket notifications*@
<div class="row">
    <div class="col-md-4">
        <div class="grid simple black ">
            <div class="grid-title no-border">
                <h4>@Model.Project.Name<span class="semi-bold"> Project</span></h4>
                <div class="tools">
                    <a href="javascript:;" class="collapse"></a>
                    <a href="#grid-config" data-toggle="modal" class="config"></a>
                    <a href="javascript:;" class="reload"></a>
                    <a href="javascript:;" class="remove"></a>
                </div>
            </div>
            <div class="grid-body no-border">
                <h4><span class="semi-bold">Other Active Tickets on Project</span></h4>

                <div id="DonutTypesChart" style="height:200px;"> </div>
            </div>
        </div>
    </div>
    @if (User.IsInRole("Admin") || (User.IsInRole("Master Admin")) || (User.IsInRole("Project Manager")))
    {
        <div class="col-md-8 col-sm-8">
            <div class="tiles gradient-grey">
                <div class="tiles-body">
                    <div class="controller">
                        <a href="javascript:;" class="reload"></a>
                        <a href="javascript:;" class="remove"></a>
                    </div>
                    <div class="tiles-title text-black">TICKET #@Model.Id NOTIFICATIONS </div>
                    <br>
                    @foreach (var notification in Model.TicketNotifications.OrderByDescending(b => b.Created))
                    {

                        <div class="notification-messages info">
                            <div class="user-profile"> <img src="@notification.Sender.AvatarURL" @*alt="" data-src="~/img/profiles/c.jpg" data-src-retina="~/img/profiles/c2x.jpg"*@ width="35" height="35"> </div>
                            <div class="message-wrapper">
                                <div class="heading"> @notification.Subject </div>
                                <div class="description"> @notification.NotificationBody </div>
                            </div>
                            <div class="date pull-right"> @notification.Created </div>
                            <div class="clearfix"></div>
                        </div>

                    }




                </div>


            </div>
        </div>



    }
    else
    {

        <div class="col-md-8 col-sm-8">
            <div class="tiles gradient-grey">
                <div class="tiles-body">
                    <div class="controller">
                        <a href="javascript:;" class="reload"></a>
                        <a href="javascript:;" class="remove"></a>
                    </div>
                    <div class="tiles-title text-black">TICKET #@Model.Id NOTIFICATIONS </div>
                    <br>
                    @foreach (var notification in Model.TicketNotifications.Where(c => c.RecipientId == user.Id).OrderByDescending(b => b.Created))
                    {

                        <div class="notification-messages info">
                            <div class="user-profile"> <img src="@notification.Sender.AvatarURL" @*alt="" data-src="~/img/profiles/c.jpg" data-src-retina="~/img/profiles/c2x.jpg"*@ width="35" height="35"> </div>
                            <div class="message-wrapper">
                                <div class="heading"> @notification.Subject </div>
                                <div class="description"> @notification.NotificationBody </div>
                            </div>
                            <div class="date pull-right"> @notification.Created </div>
                            <div class="clearfix"></div>
                        </div>

                    }




                </div>


            </div>
        </div>
    }

</div>
    @*Ticket Summary Comments and Attachments*@
    <div class="row">
        

        <div class="col-md-5 col-vlg-4 col-sm-4 no-padding">
            <div class="tiles black">
                <div class="tiles-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="grid simple">
                                <div class="grid-body no-border invoice-body">
                                    <div class="row">
                                        <div class="pull-left">
                                            <img src="/img/cooleybrand.png" data-src="/img/cooleybrand.png" data-src-retina="/img/cooleybrand.png" width="159" height="100">


                                        </div>

                                    </div>
                                    
                                    <br>
                                    <div class="row">
                                        <div class="pull-right">
                                            <h2>@Model.Title</h2>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="pull-left">
                                            
                                            <address>
                                                <strong>Cooley Code</strong><br>
                                                104 Swan Haven Lane<br>
                                                Greensboro, NC 27405<br>
                                                <abbr title="Phone">P:</abbr> (555) 555-5555
                                            </address>
                                        </div>
                                    </div>
                                    
                                    
                                    <div class="clearfix"></div>
                                    <br>
                                    <br>
                                    <br>
                                    <div class="row">
                                        <div class="col-md-9">
                                            <h4 class="semi-bold">Project Manager(s)</h4>
                                            <address>
                                                @foreach (var pm in currentProjectManagers)
                                        {
                                            <strong>@pm.FullName.</strong><br>
                                            @pm.Email<br>
                                        }


                                            </address>

                                        </div>
                                    </div>
                                        <div class=" row">
                                            <div class="col-md-9">
                                                <br>
                                                <div class="well well-small green ">
                                                    <div class="pull-left"> Ticket # : </div>
                                                    <div class="pull-right"> @Model.Id </div>
                                                    <div class="clearfix"></div>
                                                </div>

                                                
                                                <div  class="well well-small green ">
                                                    <div class="pull-left"> Ticket Priority : </div>
                                                    <div class="pull-right"> @Model.TicketPriority.Name</div>
                                                    <div class="clearfix"></div>
                                                </div>
                                               
                                                <div class="well well-small green ">
                                                    <div class="pull-left"> Ticket Type : </div>
                                                    <div class="pull-right"> @Model.TicketType.Name </div>
                                                    <div class="clearfix"></div>
                                                </div>
                                                
                                                <div class="well well-small green">
                                                    <div class="pull-left"> Ticket Status : </div>
                                                    <div class="pull-right"> @Model.TicketStatus.Name </div>
                                                    <div class="clearfix"></div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    
                                    <table class="table">
                                        <thead>
                                            <tr>

                                                <th class="text-left">DESCRIPTION</th>

                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>

                                                <td>@Model.Description</td>


                                            </tr>

                                            <tr>
                                                <td colspan="2" rowspan="4">
                                                    <h4 class="semi-bold">Developer(s)</h4>
                                                    <address>
                                                        @if (Model.AssignedToUser != null)
                                                        {
                                                            @Model.AssignedToUser.FullNameWithEmail

                                                        }
                                                        else
                                                        {


                                                        }



                                                    </address>
                                                </td>

                                            </tr>

                                        </tbody>
                                    </table>
                                    <br>
                                    <br>
                                    <h5 class="text-right text-black">Submitter(s)</h5>
                                    @*@foreach (var user in currentSubmitters)
                            {
                                <h5 class="text-right semi-bold text-black">@user.FullName</h5>
                            }*@
                                     <h5 class="text-right semi-bold text-black">@Model.OwnerUser.FullNameWithEmail</h5>
                                    <br>
                                    <br>







                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    <br />

                    <div class="grid-title  text-white">
                        <h4><span class="semi-bold"> </span></h4>
                        <div class="tools">
                            <a href="javascript:;" class="collapse"></a>
                            <a href="#grid-config" data-toggle="modal" class="config"></a>
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                    </div>
                    <div class="grid-body ">
                        <h4><span class="semi-bold text-white">Attachments  </span></h4>

                        @*<div class="tiles">*@

                            @foreach (var attachment in Model.TicketAttachments)
                            {
                                <div class="row ">


                                    <div class="col-md-3" style="width: 80px;">

                                        <img src="@BugTracker.Helpers.ImageUploadValidator.GetIconPath(attachment.FileUrl)" class="img-responsive" />
                                    </div>
                                    <div class="col-md-9">
                                        <a target="_blank" href="@attachment.FileUrl">@Path.GetFileNameWithoutExtension(attachment.FileUrl) </a>
                                    </div>








                                </div>





                            }

                        @*</div>*@






                    </div>



                    <br />

                    <div class="tiles gradient-grey">
                        <div class="tiles-body">
                            <div class="controller">
                                <a href="javascript:;" class="reload"></a>
                                <a href="javascript:;" class="remove"></a>
                            </div>
                            <div class="tiles-title text-white">TICKET #@Model.Id Comments </div>
                            <br>
                            @foreach (var comment in Model.TicketComments.OrderByDescending(c => c.Created))
                            {

                                <div class="notification-messages info">
                                    <div class="user-profile"> <img src="@comment.User.AvatarURL" @*alt="" data-src="~/img/profiles/c.jpg" data-src-retina="~/img/profiles/c2x.jpg"*@ width="35" height="35"> </div>
                                    <div class="message-wrapper">
                                        <div class="heading"> @comment.Comment </div>
                                        <div class="description"> @comment.Created </div>
                                    </div>
                                    <div class="date pull-right"> @comment.User.FirstName </div>
                                    <div class="clearfix"></div>
                                </div>

                            }




                        </div>


                    </div>


                    <br />
                    <div id="chart" style="height:123px">
                        @using (Html.BeginForm("Create", "TicketComments", FormMethod.Post))
                        {
                            @Html.AntiForgeryToken()
                            @Html.Hidden("TicketId", Model.Id);
                            <div class="comment-form-wrap container-fluid pt-5">
                                <h3 class="mb-5">Leave a comment</h3>
                                <form action="#" class="p-5 bg-light">
                                    <div class="form-group">
                                        @Html.TextArea("Comment", new { @class = "Form-control" })
                                        <button class="btn btn-primary" type="submit" value="Post">Post Comment</button>
                                    </div>


                                </form>
                            </div>
                        }

                    </div>
                </div>
            </div>

        @using (Html.BeginForm("Create", "TicketAttachments", FormMethod.Post, new { enctype = "Multipart/form-data" }))
        {
            @Html.AntiForgeryToken()
            @Html.Hidden("TicketId", Model.Id);
            <div class="col-md-6">
                <div class="grid simple">
                    <div class="grid-title no-border">
                        <h4> <span class="bold">Drag/Click To Add File</span></h4>
                        <div class="tools">
                            <a href="javascript:;" class="collapse"></a>
                            <a href="#grid-config" data-toggle="modal" class="config"></a>
                            <a href="javascript:;" class="reload"></a>
                            <a href="javascript:;" class="remove"></a>
                        </div>
                        <br />

                        <div class="row">

                            <div class="grid-body no-border">
                                <div class="row-fluid">
                                    @*<form action="/file-upload" class="dropzone no-margin">*@
                                    <div class="fallback">
                                        <input name="attachment" type="file" multiple />
                                    </div>
                                    @*</form>*@
                                </div>
                            </div>


                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="grid simple form-grid">
                                    @*<div class="grid-title no-border">
                                            <h4>Icon <span class="semi-bold">Validation</span></h4>
                                            <div class="tools">
                                                <a href="javascript:;" class="collapse"></a>
                                                <a href="#grid-config" data-toggle="modal" class="config"></a>
                                                <a href="javascript:;" class="reload"></a>
                                                <a href="javascript:;" class="remove"></a>
                                            </div>
                                        </div>*@



                                    <div class="grid-body no-border">
                                        <br>



                                        <label class="form-label bold">Add Title to file</label>
                                        <span class="help">e.g. "Client gave me a word.doc"</span>
                                        <div class="input-with-icon  right">
                                            <i class=""></i>

                                            @Html.TextBox("attachmentTitle", null, new { @class = "form-control cell-fill-input", placeHolder = "Title" })

                                            @*<input type="text" name="form1Name" id="form1Name" class="form-control">*@
                                        </div>


                                        <label class="form-label bold">Add Note to file</label>
                                        <span class="help">e.g. "Description"</span>
                                        <div class="input-with-icon  right">
                                            <i class=""></i>



                                            @Html.TextBox("attachmentDescription", null, new { @class = "form-control cell-fill-textarea", rows = 5, cols = 150, placeHolder = "Description" })

                                            @*<input type="text" name="form1Name" id="form1Name" class="form-control">*@
                                        </div>



                                        <div class="row">
                                            <button type="submit" class="btn btn-danger btn-cons"><i class="icon-ok"></i> Save</button>

                                        </div>











                                    </div>
                                </div>
                            </div>

                        </div>


                    </div>

                </div>
                <div class="col-lg-12">
                    <div class="timeline-centered timeline-sm">
                        @foreach (var item in Model.TicketHistories.OrderByDescending(c => c.Changed))
                        {
                            <article class="timeline-entry">
                                <div class="timeline-entry-inner">
                                    <time datetime="2014-01-09T13:22" class="timeline-time" ><span>@item.Changed</span></time>
                                    <div class="timeline-icon bg-orange"><i class="fa fa-paper-plane"></i></div>
                                    <div class="timeline-label bg-orange">
                                        <h4 class="timeline-title">@item.Property</h4>

                                        <p>The current ticket has been modified from the value of: @item.OldValue</p>
                                        <hr>
                                        <p>To the value of: @item.NewValue</p>
                                    </div>
                                </div>
                                
                            </article>

                        }

                    </div>
                </div>

            </div>



        }
    </div>




</div>



@section scripts{

    <script type="text/javascript">
        $(function () {
            var url = '@Url.Action("GetMorrisDataTypesOnProject", "Charts", new { id = Model.Id })';
            $.post(url).then(function (response) {
                new Morris.Donut({
                    element: 'DonutTypesChart',
                    data: response,
                    gridTextSize: 8,

                    //xkey: 'label',
                    //ykeys: ['value'],
                    //labels: ['Ticket Count'],
                    resize: true

                });

            });

        });


    </script>

<script type="text/javascript">


    $(function () {
            tinymce.init({
                selector: '#Comment'
            });
        });

    </script>
  


   
}
